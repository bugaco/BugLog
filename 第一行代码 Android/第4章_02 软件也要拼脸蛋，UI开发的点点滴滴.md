### 4.5.1 ListViewçš„ç®€å•ç”¨æ³•

åœ¨xmlå¸ƒå±€æ–‡ä»¶ä¸­å£°æ˜ListView

```xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
...
    <ListView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:id="@+id/listView"
        />
</LinearLayout>
```

åœ¨ä»£ç ä¸­å®šä¹‰æ•°æ®æºï¼š

```kotlin
private val data = listOf("Apple", "Banana", "Orange", "Watermelon",
        "Pear", "Grape", "Pineapple", "Strawberry",
        "Cherry", "Mango", "Apple", "Banana", "Orange", "Watermelon",
        "Pear", "Grape", "Pineapple", "Strawberry",
        "Cherry", "Mango","Apple", "Banana", "Orange", "Watermelon",
        "Pear", "Grape", "Pineapple", "Strawberry",
        "Cherry", "Mango")
```

è®¾ç½®ä¸€ä¸ªç®€å•çš„é€‚é…å™¨ï¼š

```kotlin
class MainActivity : AppCompatActivity() {
		...
    override fun onCreate(savedInstanceState: Bundle?) {
        ...
        val adapter = ArrayAdapter<String>(this, android.R.layout.simple_list_item_1, data)
        listView.adapter = adapter
    }
}
```

### 4.5.2 å®šåˆ¶ListViewçš„ç•Œé¢

#### ï¼ˆ1ï¼‰å…ˆåˆ›å»ºå¸ƒå±€æ–‡ä»¶ï¼ˆç±»ä¼¼iOSä¸­çš„xibæ–‡ä»¶ï¼‰ï¼š

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="horizontal"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <ImageView
        android:id="@+id/fruitImage"
        android:layout_width="40dp"
        android:layout_height="40dp"
        android:layout_gravity="center_vertical"
        android:layout_margin="10dp"
        />

    <TextView
        android:id="@+id/fruitName"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_vertical"
        android:layout_marginLeft="10dp"
        />
</LinearLayout>
```

#### ï¼ˆ2ï¼‰åˆ›å»ºå¯¹åº”çš„ç±»`FruitAdapter`ï¼Œå¹¶é‡å†™`getView`æ–¹æ³•ï¼š

```kotlin
class FruitAdapter(activity: Activity, val resourceId: Int, data: List<Fruit>): ArrayAdapter<Fruit>(activity, resourceId, data) {
    override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {
        val view = LayoutInflater.from(context).inflate(resourceId, parent, false)
        val fruitImage = view.findViewById<ImageView>(R.id.fruitImage)
        val fruitName: TextView = view.findViewById(R.id.fruitName)
        val fruit = getItem(position)
        if (fruit != null) {
            fruitImage.setImageResource(fruit.imageId)
            fruitName.text = fruit.name
        }
        return view
    }
}
```

ï¼ˆ3ï¼‰åœ¨Activityä¸­ä½¿ç”¨

```kotlin
class MainActivity : AppCompatActivity() {
    private val fruitList = ArrayList<Fruit>()
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        initFruits()
        val adapter = FruitAdapter(this, R.layout.fruit_item, fruitList)
        listView.adapter = adapter
    }

    private fun initFruits() {
        repeat(2) {
            fruitList.apply {
                add(Fruit("Apple", R.drawable.apple_pic))
                add(Fruit("Banana", R.drawable.banana_pic))
                add(Fruit("Orange", R.drawable.orange_pic))
                add(Fruit("Watermelon", R.drawable.watermelon_pic))
                add(Fruit("Pear", R.drawable.pear_pic))
                add(Fruit("Grape", R.drawable.grape_pic))
                add(Fruit("Pineapple", R.drawable.pineapple_pic))
                add(Fruit("Strawberry", R.drawable.strawberry_pic))
                add(Fruit("Cherry", R.drawable.cherry_pic))
                add(Fruit("Mango", R.drawable.mango_pic))
            }
        }
    }
}
```

æ•ˆæœï¼š

<img src="https://tva1.sinaimg.cn/large/00831rSTly1gdomvq7cgdj30as0ivgmr.jpg" alt="image-20200410140205361" style="zoom: 50%;" />

### 4.5.3 æå‡ListViewçš„è¿è¡Œæ•ˆç‡

#### 1âƒ£ï¸å¤ç”¨cell

#### 2âƒ£ï¸ViewHolder

å°†å­æ§ä»¶ç¼“å­˜å…¥ViewHolderä¸­ï¼Œä¸ç”¨æ¯æ¬¡ç”¨åˆ°çš„æ—¶å€™éƒ½è¦å»æŸ¥æ‰¾

```kotlin
class FruitAdapter(activity: Activity, val resourceId: Int, data: List<Fruit>) :
    ArrayAdapter<Fruit>(activity, resourceId, data) {

    inner class ViewHolder(val fruitImage: ImageView, val fruitName: TextView)

    override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {
        val view: View
        val viewHolder: ViewHolder
        if (convertView == null) {
            view = LayoutInflater.from(context).inflate(resourceId, parent, false)
            val fruitImage = view.findViewById<ImageView>(R.id.fruitImage)
            val fruitName: TextView = view.findViewById(R.id.fruitName)
            viewHolder = ViewHolder(fruitImage, fruitName)
            view.tag = viewHolder
        } else {
            view = convertView
            viewHolder = view.tag as ViewHolder
        }

        val fruit = getItem(position)
        if (fruit != null) {
            viewHolder.fruitImage.setImageResource(fruit.imageId)
            viewHolder.fruitName.text = fruit.name
        }
        return view
    }
}
```

### 4.5.4 ListViewçš„ç‚¹å‡»äº‹ä»¶

```kotlin
listView.setOnItemClickListener { _, _, position, _ ->
    val fruit = fruitList[position]
    Toast.makeText(this, fruit.name, Toast.LENGTH_LONG).show()
}
```

å…·ä½“å‚æ•°å«ä¹‰å¯ä»¥command + å·¦é”®ç‚¹å‡»æ–¹æ³•åå‚è€ƒæ–‡æ¡£

## 4.6 æ›´å¼ºå¤§çš„æ»šåŠ¨æ§ä»¶ï¼šRecyclerView

### 4.6.1 åŸºæœ¬ç”¨æ³•

#### 1âƒ£ï¸å¼•å…¥

åœ¨app - build.gradle æ–‡ä»¶çš„dependenciesé—­åŒ…ä¸­å¼•å…¥ï¼š

```groovy
dependencies {
    ...
    implementation 'androidx.recyclerview:recyclerview:1.1.0'
    ...
}
```

#### 2âƒ£ï¸åœ¨å¸ƒå±€æ–‡ä»¶ä¸­åˆ›å»º

å› ä¸ºä¸æ˜¯å†…ç½®åœ¨ç³»ç»ŸSDKä¸­ï¼Œæ‰€ä»¥è¦å†™å‡ºå®Œæ•´åŒ…è·¯å¾„ï¼š

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    ...>

    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/recyclerView"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        />

</LinearLayout>
```

#### 3âƒ£ï¸åˆ›å»º FruitAdapter ç±»

```kotlin
class FruitAdapter(private val fruitList: List<Fruit>): RecyclerView.Adapter<FruitAdapter.ViewHolder>() {
    inner class ViewHolder(view: View): RecyclerView.ViewHolder(view) {
        val fruitImage: ImageView = view.findViewById(R.id.fruitImage)
        val fruitName: TextView = view.findViewById(R.id.fruitName)
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context).inflate(R.layout.fruit_item, parent, false)
        return ViewHolder(view)
    }

    override fun getItemCount(): Int = fruitList.size

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val fruit = fruitList[position]
        holder.apply {
            fruitImage.setImageResource(fruit.imageId)
            fruitName.text = fruit.name
        }
    }
}
```

##### ç±»æ¯”`iOS`

å’ŒiOSç›¸æ¯”ï¼Œæ€è·¯å·®ä¸å¤šï¼š

- `getItemCount`ç›¸å½“äºcellä¸ªæ•°
- `onCreateViewHolder`ç›¸å½“äºåˆ›å»ºcellå¸ƒå±€æ–‡ä»¶
- `onBindViewHolder`æ˜¯ç”¨modelæ¸²æŸ“cell

#### 4âƒ£ï¸åœ¨Activityä¸­è®¾ç½®

```kotlin
class MainActivity : AppCompatActivity() {

    private val fruitList = ArrayList<Fruit>()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        initFruits()
        val layoutManager = LinearLayoutManager(this)
        recyclerView.layoutManager = layoutManager
        recyclerView.adapter = FruitAdapter(fruitList)
    }

    private fun initFruits() {
        ...
    }
}
```

### 4.6.2 å®ç°æ¨ªå‘æ»šåŠ¨å’Œç€‘å¸ƒæµå¸ƒå±€

#### 4.6.2.1 æ¨ªå‘æ»šåŠ¨

##### ï¼ˆ1ï¼‰å°†cellä¸­çš„å¸ƒå±€ä¿®æ”¹ä¸ºç«–ç›´æ’åˆ—

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical" // ä¿®æ”¹
    android:layout_width="wrap_content" 
    android:layout_height="wrap_content"
    android:layout_marginLeft="8dp"
    android:layout_marginRight="8dp"
    >

    <ImageView
        android:id="@+id/fruitImage"
        android:layout_width="40dp"
        android:layout_height="40dp"
        android:layout_gravity="center_horizontal" // ä¿®æ”¹
        android:layout_marginTop="10dp"
        />

    <TextView
        android:id="@+id/fruitName"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_horizontal" // ä¿®æ”¹
        android:layout_marginTop="10dp"
        />
</LinearLayout>
```

##### ï¼ˆ2ï¼‰å°†layoutManagerçš„æ–¹å‘è®¾ç½®ä¸ºæ°´å¹³

```kotlin
layoutManager.orientation = LinearLayoutManager.HORIZONTAL
```

æ•ˆæœï¼š

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdpszxuhw9j30as0irgmd.jpg" alt="image-20200411141918248" style="zoom:50%;" />

#### 4.6.2.2 ç€‘å¸ƒæµ

èµ°ä¸‹æ¥å‘ç°ï¼ŒAndroidä¸­çš„ç€‘å¸ƒæµå®ç°èµ·æ¥æ¯”iOSçš„ç®€å•å¤ªå¤šäº†ï¼ŒiOSçš„ç›®å‰ä¸ºæ­¢æˆ‘ä¹Ÿä¸èƒ½å¾’æ‰‹å†™å‡ºæ¥ğŸ˜…

åœ¨ä¸Šå°èŠ‚æ¨ªå‘æ»šåŠ¨çš„åŸºç¡€ä¸Šï¼ŒAdapterä¸ç”¨æ”¹åŠ¨ï¼Œ

##### ï¼ˆ1ï¼‰ç¨å¾®ä¿®æ”¹ä¸‹å¸ƒå±€æ–‡ä»¶

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="5dp"
    >
	...
</LinearLayout>
```



ï¼ˆ2ï¼‰ä¿®æ”¹LayoutManager

```kotlin
val layoutManager = StaggeredGridLayoutManager(3, StaggeredGridLayoutManager.VERTICAL)
recyclerView.layoutManager = layoutManager
```

å°†æ°´æœçš„åå­—å¼„çš„é€‚å½“é•¿ä¸€äº›ï¼š

```kotlin
class Fruit(var name: String, val imageId: Int) {
    init {
        val n = (1..20).random()
        var str = StringBuilder()
        repeat(n) {
            str.append(name)
        }
        name = str.toString()
    }
}
```

æ•ˆæœå›¾ï¼š

![image-20200411151037779](/Users/lyz/Library/Application Support/typora-user-images/image-20200411151037779.png)

#### 4.6.2.3 GridLayout

ç›¸æ¯” iOS çš„ UICollectionViewï¼Œç”¨èµ·æ¥æ„Ÿè§‰æ›´ç®€å•

åœ¨ç€‘å¸ƒæµçš„åŸºç¡€ä¸Šï¼Œå¸ƒå±€æ–‡ä»¶æ²¡æ”¹ï¼Œåªæ˜¯ä¿®æ”¹äº†LayoutManagerï¼š

```kotlin
val layoutManager = GridLayoutManager(this, 3)
layoutManager.orientation = GridLayoutManager.VERTICAL
recyclerView.layoutManager = layoutManager
```

æ•ˆæœï¼š

![image-20200411152313183](https://tva1.sinaimg.cn/large/007S8ZIlly1gdpuuehx46j30aw0itwh3.jpg)

### 4.6.3 RecyclerView çš„ç‚¹å‡»äº‹ä»¶

å¯¹æ¯”`ListView`

- ç¼ºç‚¹ï¼š

  RecyclerView ä¸èƒ½åƒ ListView é‚£æ ·ï¼Œç›´æ¥è®¾ç½®ç‚¹å‡»äº‹ä»¶ï¼Œåªèƒ½åœ¨ Adapter ä¸­è®¾ç½®ç‚¹å‡»äº‹ä»¶

- ä¼˜ç‚¹ï¼š

  è¿˜å¯ä»¥ä¸ºCellçš„å­æ§ä»¶åˆ†åˆ«è®¾ç½®ç‚¹å‡»äº‹ä»¶

ä»£ç å¦‚ä¸‹ï¼š

```kotlin
class FruitAdapter(private val fruitList: List<Fruit>): RecyclerView.Adapter<FruitAdapter.ViewHolder>() {
    ...

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context).inflate(R.layout.fruit_item, parent, false)
        val holder = ViewHolder(view)

        // æ³¨å†Œç‚¹å‡»äº‹ä»¶
        holder.itemView.setOnClickListener {
            val position = holder.adapterPosition
            val fruit = fruitList[position]
            Toast.makeText(parent.context, "You clicked view ${fruit.name}", Toast.LENGTH_SHORT).show()
        }
        holder.fruitImage.setOnClickListener {
            val position = holder.adapterPosition
            val fruit = fruitList[position]
            Toast.makeText(parent.context, "You clicked image ${fruit.name}", Toast.LENGTH_SHORT).show()
        }

        return holder
    }

    ...
}
```

## 4.7 ç¼–å†™ç•Œé¢çš„æœ€ä½³å®è·µ

### 4.7.1 åˆ¶ä½œ 9-Patch å›¾ç‰‡

> ä¸Šè¾¹æ¡†å’Œå·¦è¾¹æ¡†ç»˜åˆ¶çš„éƒ¨åˆ†è¡¨ç¤ºå½“å‰å›¾ç‰‡éœ€è¦æ‹‰ä¼¸æ—¶å°±æ‹‰ä¼¸é»‘ç‚¹æ ‡è®°çš„åŒºåŸŸï¼Œåœ¨ä¸‹è¾¹æ¡†å’Œå³è¾¹æ¡†ç»˜åˆ¶çš„éƒ¨åˆ†è¡¨ç¤ºå†…å®¹å…è®¸è¢«æ”¾ç½®çš„åŒºåŸŸ

åˆ¶ä½œå®Œæˆçš„æ•ˆæœå›¾ï¼š

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdpwuu0gi5j308w08xaa0.jpg" alt="image-20200411163235325" style="zoom:50%;" />

æ„Ÿè§‰æ¯”Xcodeçš„å›¾ç‰‡æ‹‰ä¼¸æ›´å¥½ç”¨ä¸€äº›ï¼Œä½†iOSå¥½ä¸€ç‚¹çš„åœ°æ–¹ï¼Œå¯ä»¥åœ¨åŸå›¾ä¸Šç›´æ¥æ“ä½œï¼Œä¸ç”¨æ–°å»ºä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶

### 4.7.2 ç¼–å†™ç²¾ç¾çš„èŠå¤©ç•Œé¢

åŒæ ·çš„ï¼Œå…ˆåœ¨`build.gradle`å¯¼å…¥ä¾èµ–åº“:

```kotlin
dependencies {
    ...
    implementation 'androidx.recyclerview:recyclerview:1.1.0'
    ...
}
```

ç¼–å†™æ•´ä½“çš„å¸ƒå±€æ–‡ä»¶ï¼š

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:background="#d8e0e8"
    >
    <androidx.recyclerview.widget.RecyclerView
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:id="@+id/recyclerView"
        />
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content">
        <EditText
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:id="@+id/editText"
            android:hint="Type something here"
            android:maxLines="2"
            />
        <Button
            android:id="@+id/sendButton"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Send"
            />
    </LinearLayout>

</LinearLayout>
```

åˆ›å»ºæ¨¡å‹ç±»`Msg`:

```kotlin
class Msg(val content: String, val type: Int) {
    companion object {
        const val TYPE_RECEIVED = 0
        const val TYPE_SENT = 1
    }
}
```

åˆ›å»ºå·¦è¾¹çš„cellå’Œå³è¾¹çš„cellå¸ƒå±€æ–‡ä»¶ï¼š

```xml
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:padding="10dp"
    android:layout_height="wrap_content">

    <LinearLayout
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="left"
        android:background="@drawable/message_left"
        >
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_margin="10dp"
            android:layout_gravity="center"
            android:id="@+id/leftMsg"
            android:textColor="#fff"
            />
    </LinearLayout>
</FrameLayout>
```

```xml
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:padding="10dp"
    android:layout_height="wrap_content">

    <LinearLayout
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="left"
        android:background="@drawable/message_left"
        >
        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_margin="10dp"
            android:layout_gravity="center"
            android:id="@+id/leftMsg"
            android:textColor="#fff"
            />
    </LinearLayout>
</FrameLayout>
```

åˆ›å»ºé€‚é…å™¨ï¼š

```kotlin
class MsgAdapter(val msgList: List<Msg>) : RecyclerView.Adapter<RecyclerView.ViewHolder>() {
    inner class LeftViewHolader(view: View) : RecyclerView.ViewHolder(view) {
        val leftMsg: TextView = view.findViewById(R.id.leftMsg)
    }

    inner class RightViewHolader(view: View) : RecyclerView.ViewHolder(view) {
        val rightMsg: TextView = view.findViewById(R.id.rightMsg)
    }

    override fun getItemViewType(position: Int): Int {
        val msg = msgList[position]
        return msgList[position].type
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder =
        when (viewType) {
            Msg.TYPE_RECEIVED -> {
                val view = LayoutInflater.from(parent.context)
                    .inflate(R.layout.msg_left_item, parent, false)
                LeftViewHolader(view)
            }
            else -> {
                val view = LayoutInflater.from(parent.context)
                    .inflate(R.layout.msg_right_item, parent, false)
                RightViewHolader(view)
            }
        }


    override fun getItemCount(): Int = msgList.size

    override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) {
        val msg = msgList[position]
        when (holder) {
            is LeftViewHolader -> {
                holder.leftMsg.text = msg.content
            }
            is RightViewHolader -> {
                holder.rightMsg.text = msg.content
            }
            else -> throw IllegalArgumentException()

        }
    }
}
```

ç„¶ååœ¨`Activity`ä¸­å°†`RecyclerView`å’Œé€‚é…å™¨å…³è”èµ·æ¥ç­‰ï¼š

```kotlin
class MainActivity : AppCompatActivity(), View.OnClickListener {

    var msgList = ArrayList<Msg>()
    val msgAdapter: MsgAdapter? = null

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        initMsgList()
        val layoutManager = LinearLayoutManager(this)
        recyclerView.layoutManager = layoutManager
        val msgAdapter = MsgAdapter(msgList)
        recyclerView.adapter = msgAdapter
        sendButton.setOnClickListener(this)
    }

    private fun initMsgList() {
        val msg1 = Msg("ä½ å¥½ | Hello | Hola | Talofa |ä½ å¥½ | Hello | Hola | Talofa ä½ å¥½ | " +
                "Hello | Hola | Talofa ä½ å¥½ | Bonjour | Hola | Talofa ä½ å¥½ | Hello | Hola | " +
                "Talofa ä½ å¥½ | Hello | Hola | Talofa ", Msg.TYPE_RECEIVED)
        val msg2 = Msg("ä½ å¥½å•Š", Msg.TYPE_SENT)
        val msg3 = Msg("ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ", Msg.TYPE_RECEIVED)
        msgList.addAll((listOf(msg1, msg2, msg3)))
    }

    override fun onClick(v: View?) {
        when (v) {
            sendButton -> {
                val content = editText.text.toString()
                if (content.isNotEmpty()) {
                    val msgSent = Msg(content, Msg.TYPE_SENT)
                    msgList.add(msgSent)
                    msgAdapter?.notifyItemInserted(msgList.size - 1)
                    recyclerView.scrollToPosition(msgList.size - 1)
                    editText.setText("")
                }
            }
        }
    }
}
```

æ•ˆæœå›¾ï¼š

![image-20200413105839482](https://tva1.sinaimg.cn/large/007S8ZIlly1gdryfsfap9j30az0ivq4t.jpg)

å³è¾¹cellçš„æ–‡æœ¬ï¼Œç«–ç›´æ–¹å‘ä¸Šä¸å¤ªå±…ä¸­ï¼Œä¸å¤ªç¡®å®šæ˜¯æ€æ ·é€ æˆçš„ï¼Œè²Œä¼¼å’Œ.9å›¾ç‰‡æœ‰å…³ç³»

## 4.8 Kotlinè¯¾å ‚ï¼šå»¶è¿Ÿåˆå§‹åŒ–å’Œå¯†å°ç±»

### 4.8.1 å¯¹å˜é‡å»¶è¿Ÿåˆå§‹åŒ–

åŠ ä¸Šå…³é”®è¯ `lateinit`å°±å¯ä»¥äº†

```kotlin
lateinit var msgAdapter: MsgAdapter
```

ç„¶åå°±å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œåè¾¹ä¸ç”¨åŠ `?`äº†ï¼š

```kotlin
msgAdapter.notifyItemInserted(msgList.size - 1)
```

åˆ¤æ–­æ˜¯å¦åˆå§‹åŒ–çš„æ–¹æ³•ï¼š

```kotlin
if (!::msgAdapter.isInitialized) {
    msgAdapter = MsgAdapter(msgList)
}
```

> ä¸ªäººæ„Ÿè§‰ï¼ŒKotlinçš„æ‡’åŠ è½½ï¼Œæ²¡æœ‰Swiftè®¾è®¡çš„ä½¿ç”¨æ–¹ä¾¿

### 4.8.2 ä½¿ç”¨å¯†å°ç±»ä¼˜åŒ–ä»£ç 

é¦–å…ˆå°è¯•å¸¸è§„æ–¹æ³•ï¼š

å®šä¹‰ä¸€ä¸ª`Result`æ¥å£ï¼Œä½¿`Success`å’Œ`Failure`éƒ½å®ç°å®ƒï¼š

```kotlin
interface Result
class Success(val msg: String): Result
class Failure(val error: Exception): Result
```

è°ƒç”¨çš„æ—¶å€™ï¼Œå¿…é¡»æ·»åŠ elseæ‰èƒ½ç¼–è¯‘é€šè¿‡ï¼š

```kotlin
fun getMsg(result: Result) = when (result) {
    is Success -> result.msg
    is Failure -> result.error.message
    else -> throw IllegalArgumentException()
}
```

ä½¿ç”¨`sealed`å…³é”®å­—åï¼Œå°±ä¸ç”¨æ·»åŠ `else`åˆ†æ”¯äº†ï¼š

```kotlin
sealed class Result
class Success(val msg: String): Result()
class Failure(val error: Exception): Result()

fun getMsg(result: Result) = when (result) {
    is Success -> result.msg
    is Failure -> result.error.message
}
```

> ç›¸æ¯”Swiftçš„ç»™æšä¸¾itemåŠ å±æ€§ï¼ŒKotlinä¸­çš„å®ç°æ„Ÿè§‰æ²¡æœ‰Swiftçš„ä¼˜é›…ã€æ–¹ä¾¿ï¼Œç”šè‡³æœ‰ç‚¹å•°å—¦ï¼Œä½†çœ‹èµ·æ¥ä¹Ÿç®—å®¹æ˜“ç†è§£

ä½¿ç”¨å¯†å°ç±»ä¼˜åŒ–åçš„ä»£ç ï¼š

```kotlin
sealed class MsgViewHolder(view: View) : RecyclerView.ViewHolder(view)
class LeftViewHolder(view: View) : MsgViewHolder(view) {
    val leftMsg: TextView = view.findViewById(R.id.leftMsg)
}

class RightViewHolder(view: View) : MsgViewHolder(view) {
    val rightMsg: TextView = view.findViewById(R.id.rightMsg)
}

class MsgAdapter(val msgList: List<Msg>) : RecyclerView.Adapter<MsgViewHolder>() {

    override fun getItemViewType(position: Int): Int {
        val msg = msgList[position]
        return msgList[position].type
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MsgViewHolder =
        when (viewType) {
            Msg.TYPE_RECEIVED -> {
                val view = LayoutInflater.from(parent.context)
                    .inflate(R.layout.msg_left_item, parent, false)
                LeftViewHolder(view)
            }
            else -> {
                val view = LayoutInflater.from(parent.context)
                    .inflate(R.layout.msg_right_item, parent, false)
                RightViewHolder(view)
            }
        }


    override fun getItemCount(): Int = msgList.size

    override fun onBindViewHolder(holder: MsgViewHolder, position: Int) {
        val msg = msgList[position]
        when (holder) {
            is LeftViewHolder -> holder.leftMsg.text = msg.content
            is RightViewHolder -> holder.rightMsg.text = msg.content
        }
    }
}
```

